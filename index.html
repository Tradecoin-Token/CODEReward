<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta http-equiv="content-type" content="text/plain; charset=UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CODE DApp Statistics</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <style>
        .no-focus:focus{
            box-shadow:none !important;
            outline:none !important;
        }
        
        a:link, a:visited {
  background-color: #f44336;
  color: white;
  padding: 15px 25px;
  text-align: center;
  text-decoration: none;
  display: inline-block;
}        


    </style>
</head>
<body>
    <div id="loading" class="text-center py-5">
        <span class="spinner-border text-warning" role="status"></span>
    </div>
    <div id="mainArea" class="d-none">
        <div class="shadow-sm py-3 text-center">
            <img src="logo.jpg" height="80px;">
            <h4 class="d-inline" style="vertical-align:middle;"><CODE>&#60; CODE DApp Statistics &#62; </CODE> </h4>
        </div>
                    
        <div class="container-fluid mx-auto py-5 px-lg-5">
            <div class="row">
            
                <div class="col-md-3 col-12 mb-3">
                    <div class="card py-3" style="background: #0dbaae;">
                        <div class="card-body text-center h4 text-white" id="panel0"></div>
                    </div>
                </div>           
           
                <div class="col-md-3 col-12 mb-3">
                    <div class="card py-3" style="background: #0dbaae;">
                        <div class="card-body text-center h4 text-white" id="panel1"></div>
                    </div>
                </div>
                <div class="col-md-3 col-12 mb-3">
                    <div class="card py-3" style="background: #0dbaae;">
                        <div class="card-body text-center h4 text-white" id="panel2"></div>
                    </div>
                </div>
                <div class="col-md-3 col-12 mb-3">
                    <div class="card py-3" style="background: #0dbaae;">
                        <div class="card-body text-center h4 text-white" id="panel3"></div>
                    </div>
                </div>
                <div class="col-md-3 col-12 mb-3">
                    <div class="card py-3" style="background: #0dbaae;">
                        <div class="card-body text-center h4 text-white" id="panel4"></div>
                    </div>
                </div>
                
                <div class="col-md-3 col-12 mb-3">
                    <div class="card py-3" style="background: #0dbaae;">
                        <div class="card-body text-center h4 text-white" id="panel5"></div>
                    </div>
                </div>

                <div class="col-md-3 col-12 mb-3">
                    <div class="card py-3" style="background: #0dbaae;">
                        <div class="card-body text-center h4 text-white" id="panel6"></div>
                    </div>
                </div>

                <div class="col-md-3 col-12 mb-3">
                    <div class="card py-3" style="background: #0dbaae;">
                        <div class="card-body text-center h4 text-white" id="panel7"></div>
                    </div>
                </div>

                <div class="col-md-3 col-12 mb-3">
                    <div class="card py-3" style="background: #0dbaae;">
                        <div class="card-body text-center h4 text-white" id="panel8"></div>
                    </div>
                </div>

                <div class="col-md-3 col-12 mb-3">
                    <div class="card py-3" style="background: #0dbaae;">
                        <div class="card-body text-center h4 text-white" id="panel9"></div>
                    </div>
                </div>

                <div class="col-md-3 col-12 mb-3">
                    <div class="card py-3" style="background: #0dbaae;">
                        <div class="card-body text-center h4 text-white" id="panel10"></div>
                    </div>
                </div>                

                </div>
                
            </div>
        </div>

        
        <div class="mx-auto p-md-5 p-4 rounded-lg text-white" style="background-color: #ff007f; max-width: 450px;">
            <h4 class="text-center mb-4">CODE Reward Calculator</h4>
            Enter Your CODE Amount for Staking:
            <input type="number" id="amount" onchange="Calculate()" class="form-control no-focus p-3"><br>

            Staking Period (7-200 Days):
            <input id="days" type="number" min="7" max="200" class="form-control no-focus p-3" onchange="Calculate()"><br>
            <h4 id="total"></h4>
            <button class="btn btn-success w-100 py-3" onclick="Calculate()">Calculate</button><br><br>
            <button class="btn btn-success w-100 py-3" onclick="location.href='https://polarity.exchange/dapps?dapp=3JuU5pZWi1ywd4WaG5ex4EGkMFWQRK2oNWu';">Proceed For CODE Minting</button>
        </div>

        <div class="container-fluid mx-auto py-5 px-lg-5">
            <div class="row">
                <div class="col-md-9 pb-3">
                    <div class="form-group rounded position-relative border p-1">
                        <label class="small ml-3 mt-n3 px-2 position-absolute bg-white">Enter Address</label>
                        <input type="text" class="form-control border-0 px-4 no-focus" oninput="search(this.value);">
                    </div>
                </div>
                <div class="col-md-3 pb-3">
                    <div class="form-group rounded position-relative border p-1">
                        <label class="small ml-3 mt-n3 px-2 position-absolute bg-white">Sort By</label>
                        <select class="custom-select no-focus border-0 pl-3" onchange="sortData(this.value);">
                            <option value="0" selected>Staking Amount (Hight to Low)</option>
                            <option value="1">Staking Amount (Low to Hight)</option>
                            <option value="2">Address (A-Z)</option>
                            <option value="3">Address (Z-A)</option>
                        </select>
                    </div>
                </div>
            </div>
            <div id="resultArea"></div>
        </div>
    </div>
    <script>
        const APIURL = "https://tnnode2.turtlenetwork.eu/addresses/data/3JuU5pZWi1ywd4WaG5ex4EGkMFWQRK2oNWu";

        var loanData = '';
        var loading = document.getElementById("loading");
        var mainArea = document.getElementById("mainArea");
        var resultArea = document.getElementById("resultArea");
        var address = '';
        var sortRule = 0;
        var blockHeight;
        
        
        window.onload = async function(){
            var responseObject = await fetch(APIURL);
            loanData = await responseObject.json();
            var results4 = loanData.filter(entry => entry.key.includes("Rewards_Of_")); 
            
            sumRewardAmount = 0;
            for (i = 0; i < results4.length; i++) {  //loop through the array
            sumRewardAmount += results4[i].value;  //Do the math!
            }                                    

            document.getElementById("panel0").innerHTML = 'Next Supply Batch</><br>'+((sumRewardAmount)/100000000).toFixed(8)+' CODE<br><font color="yellow"><sup>'+results4.length+' Claims</sup></font>'+'<br><i class="fa fa-info-circle" data-toggle="tooltip" title="Next Supply Batch is upcoming Release Quantity of CODE To Mint and Claim by N No Users."></i>';            
            
                                 
            var panel1ResponseObject = await fetch("https://tnnode2.turtlenetwork.eu/addresses/data/3JuU5pZWi1ywd4WaG5ex4EGkMFWQRK2oNWu/Total_Issued_CODE%3A");
            panel1Data = await panel1ResponseObject.json();
            document.getElementById("panel1").innerHTML = 'Total CODE Minted<br>'+(panel1Data.value/100000000).toFixed(8)+' &#x26CF'+'<br><i class="fa fa-info-circle" data-toggle="tooltip" title="Total Minted CODE!"></i>';

            var panel2ResponseObject = await fetch("https://tnnode2.turtlenetwork.eu/addresses/data/3JuU5pZWi1ywd4WaG5ex4EGkMFWQRK2oNWu/Total_Burned_CODE:");
            panel2Data = await panel2ResponseObject.json();
            document.getElementById("panel2").innerHTML = 'Total CODE Burned<br>'+(panel2Data.value/100000000).toFixed(8)+' &#128293'+'<br><font color="yellow"><sub>(-'+
            ((panel2Data.value/100000000)/(panel1Data.value/100000000)*100).toFixed(2)+'%)</font></sub>';
            BurnedCODE = panel2Data.value;
            
            var panel3ResponseObject = await fetch("https://tnnode2.turtlenetwork.eu/addresses/data/3JuU5pZWi1ywd4WaG5ex4EGkMFWQRK2oNWu/Total_CODE_Claimed:");
            panel3Data = await panel3ResponseObject.json();
            document.getElementById("panel3").innerHTML = 'Total CODE Claimed<br>'+(panel3Data.value/100000000).toFixed(8)+" &#x2696"+'<br><i class="fa fa-info-circle" data-toggle="tooltip" title="Total CODE Claimed by Users."></i>';
            TotalCODEClaimed = panel3Data.value;
            
            var panel4ResponseObject = await fetch("https://tnnode2.turtlenetwork.eu/blocks/height");
            panel4Data = await panel4ResponseObject.json();
            document.getElementById("panel4").innerHTML = 'Block &#9939; Height<br>'+panel4Data.height+'<br><i class="fa fa-info-circle" data-toggle="tooltip" title="Current Blockchain Height."></i>';
            blockHeight = panel4Data.height;

            BlockPassed = blockHeight-1850000
            document.getElementById("panel5").innerHTML = 'Block Passed<br>'+(BlockPassed).toFixed(0)+'<br><i class="fa fa-info-circle" data-toggle="tooltip" title="It tell how many blocks has been passed since the Launch of StartHeight of CODE DApp."></i>';
            
            Inflation = (10000000/BlockPassed)
            document.getElementById("panel6").innerHTML = 'Inflation No.<br>'+((Inflation)+6).toFixed(3)+'<br><i class="fa fa-info-circle" data-toggle="tooltip" title="Inflation was Started from 10M and its decreasing by each passing block."></i>';
            
            Max_Staking_Allowed = BlockPassed*0.001        
            document.getElementById("panel7").innerHTML = 'Max. Staking Allowed<br>'+(Max_Staking_Allowed).toFixed(8)+'<br><i class="fa fa-info-circle" data-toggle="tooltip" title="How much User can Stake at Current Blockchain Height."></i>';    
                    
            var panel8ResponseObject = await fetch("https://tnnode2.turtlenetwork.eu/addresses/data/3JuU5pZWi1ywd4WaG5ex4EGkMFWQRK2oNWu/Total_Txns:");
            panel8Data = await panel8ResponseObject.json();
            document.getElementById("panel8").innerHTML = 'Total Txns<br>'+(panel8Data.value).toFixed(0)+'<br><i class="fa fa-info-circle" data-toggle="tooltip" title="Total Transactions Record on CODE Dapp."></i>';
            TotalTxns = panel8Data.value;

            var panel9ResponseObject = await fetch("https://matcher.turtlenetwork.eu/matcher/orderbook/7RB3BWayeCVPq3kkpkeJZAFv2DYCB5gEwnutEpRofaw4/EB4CUQH4fHzzQt9YjcHtA6T7uosHNH9RnQKHgBdZHPCB/status");
            panel9Data = await panel9ResponseObject.json();
            document.getElementById("panel9").innerHTML = 'Last '+(panel9Data.lastSide).toUpperCase()+' Price<br>'+(panel9Data.lastPrice/1000000).toFixed(4)+" $"+'<br><i class="fa fa-info-circle" data-toggle="tooltip" title="Last Price of CODE on TN Dex."></i>';
            TotalTxns = panel9Data.value;

            var panel10ResponseObject = await fetch("https://matcher.turtlenetwork.eu/matcher/orderbook/7RB3BWayeCVPq3kkpkeJZAFv2DYCB5gEwnutEpRofaw4/EB4CUQH4fHzzQt9YjcHtA6T7uosHNH9RnQKHgBdZHPCB/status");
            panel10Data = await panel10ResponseObject.json();
            document.getElementById("panel10").innerHTML = 'Marketcap of'+' CODE<br>'+((panel10Data.lastPrice/1000000)*(34500+(panel1Data.value/100000000))).toFixed(2)+" $"+'<br><i class="fa fa-info-circle" data-toggle="tooltip" title="Marketcap of CODE."></i>';
            TotalTxns = panel9Data.value;            
            
            loading.remove();
            mainArea.classList.remove('d-none');
            showData(loanData, sortRule);
        }

        window.setTimeout(function () {
  window.location.reload();
}, 300000);
        
        
        function search(value){
            address = value.trim();
            showData(loanData, sortRule);
        }

        function sortData(value){
            sortRule = value;
            showData(loanData, sortData);
        }

        function showData(loanData, sort){
            var data = loanData;
            var output = '';
            var allIndex = [];
            var searchResult = [];
            data.forEach(function(item, index){
                if(item.key.includes(address)){
                    thisKey = item.key.substring(item.key.lastIndexOf("_")+1);
                    thisValue = item.value;
                    if(allIndex.indexOf(thisKey) < 0){
                        allIndex.push(thisKey);
                        searchResult.push({Address:thisKey});
                    }
                    var thisIndex = allIndex.indexOf(thisKey);
                    if(item.key.includes('Deposit_height')){
                        searchResult[thisIndex].DepositHeight = item.value;
                    }
                    if(item.key.includes('Deposit_Amount')){
                        searchResult[thisIndex].DepositAmount = item.value;
                    }
                    if(item.key.includes('Rewards')){
                        searchResult[thisIndex].Rewards = item.value;
                    }
                    if(item.key.includes('Total_Lock_Blocks')){
                        searchResult[thisIndex].TotalLockBlocks = item.value;
                    }                    
                }
            });

            if(searchResult.length > 0){
                searchResult.forEach(function(item, index){
                    if(searchResult[index].DepositAmount === undefined){
                        delete searchResult[index];
                    }
                });

                if(sortRule == 0){
                    searchResult.sort(function (a, b) {
                        return parseFloat(a.DepositAmount) - parseFloat(b.DepositAmount);
                    });
                    searchResult =  searchResult.reverse();
                }else if(sortRule == 1){
                    searchResult.sort(function (a, b) {
                        return parseFloat(a.DepositAmount) - parseFloat(b.DepositAmount);
                    });
                }else if(sortRule == 2){
                    searchResult.sort(function (a, b) {
                        return a.Address - b.Address;
                    });
                }else if(sortRule == 3){
                    searchResult.sort(function (a, b) {
                        return a.Address - b.Address;
                    });
                    searchResult =  searchResult.reverse();
                }

                output += '<div class="table-responsive">'
                output += '<table class="table border table-borderless table-striped table-dark" id="table">'
                output += '<thead class="text-white" style="background-color: #ff007f">';
                output += '<tr>';
                output += '<th>Address</th>';
                output += '<th>Deposit Height</th>';
                output += '<th>Staking Amount</th>';
                output += '<th>Maturity Amount</th>';
                output += '<th>Mature Height</th>';
                output += '<th>Maturity Indicator</th>';
				output += '<th>Balance Hours</th>';
                output += '</tr>';
                output += '</thead>';
                output += '<tbody>';
                searchResult.forEach(function(item, index){
                    output += '<tr style="cursor:pointer;">';
                    output += '<td>'+searchResult[index].Address+'</td>';
                    if(searchResult[index].DepositHeight === undefined || String(searchResult[index].DepositHeight).length < 1){
                        output += '<td>N&#47;A</td>';
                    }else{
                        output += '<td>'+searchResult[index].DepositHeight+'</td>';
                    }

                    if(searchResult[index].DepositAmount === undefined || String(searchResult[index].DepositAmount).length < 1){
                        output += '<td>N&#47;A</td>';
                    }else{
                        output += '<td>'+(searchResult[index].DepositAmount/100000000).toFixed(8)+' CODE</td>';
                    }
                    if(searchResult[index].Rewards === undefined || String(searchResult[index].Rewards).length < 1){
                        output += '<td>N&#47;A</td>';
                    }else{
                        output += '<td>'+(searchResult[index].Rewards/100000000)+' CODE</td>';
                    }
                    if(searchResult[index].TotalLockBlocks === undefined || String(searchResult[index].TotalLockBlocks).length < 1){
                        output += '<td>N&#47;A</td>';
                    }else{
                        output += '<td>'+searchResult[index].TotalLockBlocks+'</td>';
                    }
                    
                    var Indicator = parseInt(searchResult[index].TotalLockBlocks- blockHeight);
                    output += '<td>';
                        if(Indicator > 0){
                            output += '<span class="bg-success px-2 py-1 w-100 small rounded text-white">Immature</span>'+" "+'<td>'+(Indicator/60).toFixed(6)+" Hrs";
                        }else{
                            output += '<span class="bg-danger px-2 py-1 w-100 small rounded text-white">Mature</span>';
                        }
                    output += '</td>';
                    output += '</tr>';
                });
                output += '</tbody>';
                output += '</table>';
                output += '</div>';

                output += '<div class="text-center pt-3"><button class="btn btn-success px-5 py-3" onclick="exportTableToCSV(\'download.csv\');">Download As Excel</button></div>';
                output += '<div class="text-center pt-3"><a href="https://csvjson.com/csv2json">Upload Excel Output To get Json</button></div></a>';
                
            }else{
                output = '<h4 class="text-center mt-4">Opps!! No Result was found.</h4>';
            }
            resultArea.innerHTML = output;
        }

        function Calculate() {
        	const amount = document.querySelector("#amount").value;

        	const days = document.querySelector("#days").value;
            
            if(amount>=0 && amount <=0.00099999)
            {
            alert("Please Enter Amount Minimum 0.001 CODE.");
            }
            
            if(amount>=0.001 && amount <=Max_Staking_Allowed)
            {
        	Estimated_Rewards = ((Inflation*amount*days)/365).toFixed(8);
           
            }
            if(amount > Max_Staking_Allowed)
            {
        	alert("Maximum Staking Amount Allowed at Current Block Height is: "+(Max_Staking_Allowed).toFixed(8)+" CODE.");
            }            
          
        	const totalinterest = Estimated_Rewards;
        	document.querySelector("#total").innerHTML = "Claim Amt: "+totalinterest+" CODE<br><br>Returns: "+((Estimated_Rewards/amount)*100).toFixed(2)+"%"+"<br><br>Fee Charged: "+(Estimated_Rewards*1/100).toFixed(8)+" CODE";

            
            
        }
        
		function exportTableToCSV(filename) {
			var csv = [];
			var rows = document.querySelectorAll("table tr");
			for (var i = 0; i < rows.length; i++) {
				var row = [], cols = rows[i].querySelectorAll("td, th");
				for (var j = 0; j < cols.length; j++) 
					row.push(cols[j].innerText);   
				csv.push(row.join(","));        
			}
			downloadCSV(csv.join("\n"), filename);
		}
        
		function downloadCSV(csv, filename) {
			var csvFile;
			var downloadLink;
			csvFile = new Blob([csv], {type: "text/csv"});
			downloadLink = document.createElement("a");
			downloadLink.download = filename;
			downloadLink.href = window.URL.createObjectURL(csvFile);
			downloadLink.style.display = "none";
			document.body.appendChild(downloadLink);
			downloadLink.click();
		}
        

        
        

    </script>
</body>
</html>
